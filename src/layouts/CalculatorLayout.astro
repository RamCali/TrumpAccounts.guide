---
import BaseLayout from './BaseLayout.astro';
import { webApplicationSchema, breadcrumbSchema, financialProductSchema } from '../lib/seo/schema';
import { getLocaleFromUrl, useTranslations, getLocalizedPath } from '../i18n/config';

interface Props {
  title: string;
  description: string;
  calculatorName: string;
  slug: string;
  abstract?: string;
}

const { title, description, calculatorName, slug, abstract } = Astro.props;

const locale = getLocaleFromUrl(Astro.url);
const t = useTranslations(locale, 'common');
const lp = (path: string) => getLocalizedPath(path, locale);
const isEs = locale === 'es';

const siteUrl = 'https://trumpaccounts.guide';
const calcBase = isEs ? '/es/calculadoras' : '/calculators';

const schemas = [
  webApplicationSchema({
    name: calculatorName,
    description,
    url: `${siteUrl}${calcBase}/${slug}`,
    ...(abstract && { abstract }),
    inLanguage: locale,
  }),
  financialProductSchema(),
  breadcrumbSchema([
    { name: t('calc.home'), url: isEs ? `${siteUrl}/es` : siteUrl },
    { name: t('calc.calculators'), url: `${siteUrl}${calcBase}` },
    { name: calculatorName, url: `${siteUrl}${calcBase}/${slug}` },
  ]),
];

// Cross-link data — translated for Spanish
const crossLinks = isEs ? [
  { slug: 'calculadora-de-crecimiento', title: 'Calculadora de Crecimiento', desc: 'Vea cómo $1,000 puede crecer en 18+ años' },
  { slug: 'verificador-de-elegibilidad', title: 'Verificador de Elegibilidad', desc: '¿Califica su hijo para la subvención de $1,000?' },
  { slug: 'contribucion-del-empleador', title: 'Contribución del Empleador', desc: 'Calcule el beneficio de contribución de su empleador' },
] : [
  { slug: 'growth-calculator', title: 'Growth Calculator', desc: 'See how $1,000 can grow over 18+ years' },
  { slug: 'eligibility-checker', title: 'Eligibility Checker', desc: 'Does your child qualify for the $1,000 grant?' },
  { slug: 'employer-match', title: 'Employer Match Calculator', desc: 'Calculate your employer contribution benefit' },
  { slug: 'withdrawal-simulator', title: 'Withdrawal Simulator', desc: 'See the tax impact of withdrawing at different ages' },
  { slug: 'fund-expense-tracker', title: 'Fund Expense Tracker', desc: 'Compare eligible ETFs and their expense ratios' },
  { slug: 'legacy-calculator', title: 'Legacy Calculator', desc: 'See the value at age 18, 30, and 65' },
  { slug: 'cost-of-waiting', title: 'Cost of Waiting Calculator', desc: 'See how much delay costs your child' },
  { slug: 'milestones', title: 'Milestone Calculator', desc: 'When will the account hit $100K or $1M?' },
  { slug: 'inflation-comparison', title: 'Inflation Comparison', desc: 'Savings account vs Trump Account over time' },
  { slug: 'grant-eligibility', title: 'Grant Eligibility', desc: 'Check if your ZIP code qualifies for grants like the Dell pledge' },
];
---

<BaseLayout title={title} description={description} schema={schemas}>
  <div class="mx-auto max-w-4xl px-4 py-8">
    <!-- Breadcrumb -->
    <nav aria-label="Breadcrumb" class="mb-6">
      <ol class="flex items-center gap-2 text-sm text-gray-500">
        <li><a href={isEs ? '/es' : '/'} class="hover:text-gold-400 no-underline">{t('calc.home')}</a></li>
        <li class="before:mr-2 before:content-['/']">
          <a href={calcBase} class="hover:text-gold-400 no-underline">{t('calc.calculators')}</a>
        </li>
        <li class="before:mr-2 before:content-['/']">
          <span class="text-white font-medium">{calculatorName}</span>
        </li>
      </ol>
    </nav>

    <h1 class="mb-2 text-3xl font-extrabold text-white md:text-4xl">{title}</h1>
    <p class="mb-8 text-lg text-gray-400">{description}</p>

    <slot />

    <!-- Disclaimer -->
    <div class="mt-10 rounded-lg border border-amber-500/30 bg-amber-500/10 p-4">
      <p class="text-sm text-amber-300">
        <strong class="text-amber-200">{t('calc.disclaimer')}</strong> {t('calc.disclaimerText')}
      </p>
    </div>

    <!-- Cross-links to other calculators -->
    <div class="mt-8">
      <h2 class="mb-4 text-lg font-bold text-white">{t('calc.moreCalcs')}</h2>
      <div class="grid gap-3 sm:grid-cols-2">
        {crossLinks.filter(link => link.slug !== slug).map(link => (
          <a href={`${calcBase}/${link.slug}`} class="rounded-lg border border-surface-600 p-4 no-underline hover:border-gold-400/30 hover:bg-gold-400/5 transition-colors">
            <h3 class="font-semibold text-white">{link.title}</h3>
            <p class="text-sm text-gray-400">{link.desc}</p>
          </a>
        ))}
      </div>
    </div>
  </div>
</BaseLayout>
