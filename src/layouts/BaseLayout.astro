---
import '../styles/global.css';
import DisclosureBanner from '../components/layout/DisclosureBanner.astro';
import Header from '../components/layout/Header.astro';
import Footer from '../components/layout/Footer.astro';
import OpenGraph from '../components/seo/OpenGraph.astro';
import SchemaOrg from '../components/seo/SchemaOrg.astro';
import { getLocaleFromUrl } from '../i18n/config';
import { getAlternateUrl } from '../i18n/url-map';

interface Props {
  title: string;
  description: string;
  canonical?: string;
  schema?: Record<string, unknown> | Record<string, unknown>[];
  ogType?: string;
  alternateSlug?: string;
  abstract?: string;
}

const {
  title,
  description,
  canonical,
  schema,
  ogType = 'website',
  alternateSlug,
} = Astro.props;

const locale = getLocaleFromUrl(Astro.url);
const siteUrl = 'https://trumpaccounts.guide';
const canonicalUrl = canonical || new URL(Astro.url.pathname, siteUrl).toString();
const fullTitle = title.includes('TrumpAccounts') ? title : `${title} | TrumpAccounts.guide`;
const alternateUrl = alternateSlug
  ? new URL(alternateSlug, siteUrl).toString()
  : new URL(getAlternateUrl(Astro.url.pathname, locale), siteUrl).toString();
const skipText = locale === 'es' ? 'Ir al contenido' : 'Skip to content';
---

<!doctype html>
<html lang={locale}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="canonical" href={canonicalUrl} />
    <meta name="generator" content={Astro.generator} />

    <!-- hreflang for i18n -->
    <link rel="alternate" hreflang={locale === 'en' ? 'en' : 'es'} href={canonicalUrl} />
    <link rel="alternate" hreflang={locale === 'en' ? 'es' : 'en'} href={alternateUrl} />
    <link rel="alternate" hreflang="x-default" href={locale === 'en' ? canonicalUrl : alternateUrl} />

    <!-- Performance hints -->
    <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin />

    <!-- LLMs discovery â€” see https://llmstxt.org -->
    <link rel="alternate" type="text/plain" href="/llms.txt" title="LLM-readable site summary" />

    <!-- Google Tag Manager -->
    <script is:inline>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PZG237LN');</script>
    <!-- End Google Tag Manager -->

    <title>{fullTitle}</title>
    <meta name="description" content={description} />

    <OpenGraph
      title={fullTitle}
      description={description}
      url={canonicalUrl}
      type={ogType}
      locale={locale}
    />

    {schema && <SchemaOrg schema={schema} />}
  </head>
  <body class="flex min-h-screen flex-col bg-surface-900">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PZG237LN"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <a href="#main-content" class="skip-link">{skipText}</a>
    <DisclosureBanner />
    <Header />
    <main id="main-content" class="flex-1">
      <slot />
    </main>
    <Footer />
  </body>
</html>
